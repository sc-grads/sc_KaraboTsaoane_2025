name: SQL Deployment with Manual Approval

on:
  push:
    branches: [ main ]
    paths: [ 'DatabaseAdministration/SQLStatements/create_db2.sql' ]

jobs:
  development:
    name: Deploy to Development
    uses: ./.github/workflows/sql-deployment-template.yml
    with:
      sql_file: DatabaseAdministration/SQLStatements/create_db2.sql
    secrets:
      SQL_SERVER: ${{ secrets.SQL_SERVER }}
      SQL_USER: ${{ secrets.SQL_USER }}
      SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}

  approve-production:
    name: Wait for Manual Approval
    needs: development
    runs-on: ubuntu-latest
    environment:
      name: production
      url: 'https://rnimg-102-66-182-14.a.free.pinggy.link:44225'
    steps:
      - name: Awaiting approval to deploy to production
        run: echo " Approved! Proceeding to production deployment."

  run-production-deploy:
    name: Deploy to Production via Template
    needs: approve-production
    uses: ./.github/workflows/sql-deployment-template.yml
    with:
      sql_file:  DatabaseAdministration/SQLStatements/create_db2.sql
    secrets:
      PROD_SQL_SERVER: ${{ secrets.PROD_SQL_SERVER }}
      PROD_SQL_USER: ${{ secrets.PROD_SQL_USER }}
      PROD_SQL_PASSWORD: ${{ secrets.PROD_SQL_PASSWORD }}
